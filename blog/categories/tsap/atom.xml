<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: цап | My Octopress Blog]]></title>
  <link href="http://arktur04.github.io/blog/categories/tsap/atom.xml" rel="self"/>
  <link href="http://arktur04.github.io/"/>
  <updated>2015-12-20T18:37:28+05:00</updated>
  <id>http://arktur04.github.io/</id>
  <author>
    <name><![CDATA[Your Name]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Проект видеоадаптера. Часть 3]]></title>
    <link href="http://arktur04.github.io/blog/2015/11/23/%25d0%25bf%25d1%2580%25d0%25be%25d0%25b5%25d0%25ba%25d1%2582-%25d0%25b2%25d0%25b8%25d0%25b4%25d0%25b5%25d0%25be%25d0%25b0%25d0%25b4%25d0%25b0%25d0%25bf%25d1%2582%25d0%25b5%25d1%2580%25d0%25b0-%25d1%2587%25d0%25b0%25d1%2581%25d1%2582%25d1%258c-3/"/>
    <updated>2015-11-23T21:00:45+05:00</updated>
    <id>http://arktur04.github.io/blog/2015/11/23/%d0%bf%d1%80%d0%be%d0%b5%d0%ba%d1%82-%d0%b2%d0%b8%d0%b4%d0%b5%d0%be%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%d0%b0-%d1%87%d0%b0%d1%81%d1%82%d1%8c-3</id>
    <content type="html"><![CDATA[<p>Продолжение. <a href="http://arktur04.github.io/blog/2015/11/05/vga-%25d0%25b0%25d0%25b4%25d0%25b0%25d0%25bf%25d1%2582%25d0%25b5%25d1%2580-%25d0%25bd%25d0%25b0-fpga/">Часть 2.</a></p>


<p>Структурная схема видеоадаптера приведена на рис. 1 (кликабельно)</p>


<p><a href="/images/2015/11/vga-card-big.jpg"><img class="alignnone size-medium wp-image-2175" alt="vga-card-big" src="/assets/vga-card-big-300x214.jpg" width="300" height="214" /></a></p>


<p>&nbsp;</p>


<p>Рис. 1. Структурная схема видеоадаптера.</p>


<p>&nbsp;</p>


<p>Пояснения к схеме:</p>


<p>В первой версии видеоадаптер будет иметь только текстовый режим EGA, 80 * 25 символов 8 * 14 пикселов каждый символ. Таким образом, экранное разрешение составит 8 * 80 = 640 пикселов по горизонтали и 14 * 25 = 350 пикселов по вертикали. Частота пикселов в этом режиме составляет, по стандарту 25,175 МГц, фактическая частота будет 25 МГц, в связи с тем, что частота тактирования ПЛИС составляет 50 МГц. При этом на любом мониторе происходит нормальная синхронизация.</p>


<p><!--more--></p>


<p>Для аналогичного тектового видеорежима VGA разрешение составляет 720 * 400 пикселей, т.к. символы имеют размер 9*16 пикселей. Частота пикселов при этом должна быть 28,322 МГц, и нормальная синхронизация с частотой 25 МГц невозможна. Можно получить близкую частоту с помощью PLL, но тогда потребуются блоки для асинхронного сопряжения видеоадаптера с микропроцессорной частью проекта, т.к. микропроцессорная часть будет тактироваться частотой 50 МГц. Это будет следующим этапом проекта, пока вся схема будет тактироваться от 50 МГц.</p>


<p>Графические режимы тоже будут позже, пока будет реализован максимально простой вариант.</p>


<p>Некоторые пояснения по схеме:</p>


<p><strong>sync_gen</strong> - генератор синхроимпульсов. Имеет выходы <em>h_coord_reg</em> и <em>v_coord_reg</em>, соответственно, текущие координаты пиксела по горизонтали и вертикали. <em>data_en</em> - сигнал разрешения данных. Этот же сигнал используется для "гашения" выходов ЦАП. <em>hsync_reg</em> и<em> vsync_reg</em> - сигналы горизонтальной и вертикальной синхронизации.</p>


<p>Так как вся схема состоит из нескольких модулей, включенных последовательно, прохождение сигнала по ним занимает несколько тактов. В связи с этим сигналы <em>data_en, <em>hsync_reg</em> </em>и <em><em>vsync_reg</em></em> также должны быть задержаны, чтобы приходить на выход синхронно с сигналами соответствующего пиксела.</p>


<p><strong>addr_decoder</strong> - так как видеоадаптер будет использовать в качестве видеопамяти внешнюю sdram, которая будет использоваться совместно с основным микропроцессором, <strong> </strong>необходимо иметь небольшую буферную память, чтобы избежать проблем, связанных с временем доступа к внешней памяти. Этот буфер будет двойным, пока идёт выборка из одного блока памяти, в другой загружаются данные из внешней памяти, затем они меняются местами. каждый блок памяти будет иметь размер 256*16 бит. 16-и битный выход позволит получит сразу и ком символа, и информацию об его цвете. Модуль <strong>addr_decoder</strong> вырабатывает текущий адрес в буфере <em>buffer_addr_reg</em>, исходя из текущей координаты пиксела и смещения буфера (т.е. адреса, который отображается на начало буфера). Также этот модуль вырабатывает сигналы <em>hmod_reg</em> и <em>vmod_reg</em>, которые являются координатой пиксела в текущем знакоместе (т.е. абсолютной координатой по модулю 8 и 14 соответственно).</p>


<p><strong>buf_mem </strong> - буфер памяти, см. предыдущий абзац.</p>


<p><strong>mem_controlle</strong>r - контроллер памяти. Должен обеспечивать подкачку содержимого буфера из внешней SDRAM. Также, в будущем, будет обеспечивать асинхронные взаимодействия видеоадаптера и основной части, при их работе на разной тактовой частоте.</p>


<p><strong>mode_controller</strong> - контроллер видеорежима. Пока видеоадаптер будет иметь только один текстовый режим, но в будущем контроллер должен будет обесипечивать установку всех остальных модулей в состояние, соответствующее текущему видеорежиму. Также модуль выделяет код символа (<em>char_code_reg</em>), цвет символа (<em>char_color_reg</em>), цвет фона (<em>back_color_reg</em>) и признак мигания <em>blink</em>.</p>


<p><strong>char_gen</strong> - знакогенератор. В данной версии представляет собой ПЗУ с таблицей символов EGA (8*14), но впоследствии будет содержать символы VGA (9*16) и символы 8*8, а также программируемые пользователем символы. На его вход поступает код символа (<em>char_code</em>) и номер строки символа (<em>vmod</em>), на выходе появляется строка текущего знакоместа (<em>char_data_reg</em>).</p>


<p><strong>pixel_data_decode</strong>r - на основании сигналов <em>char_data, hmod, char_color, back_color, blink</em> определяет цвет текущего пиксела в палитре.</p>


<p><strong>palette</strong> - регистры палитры. В данной версии представляет собой ПЗУ, в дальнейшем будет возможность его изменения пользовательской программой.</p>


<p>Пока это черновик схемы, она будет дорабатываться и изменяться по мере продвижения проекта.</p>


<p>&nbsp;</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Проект видеоадаптера. Часть 2]]></title>
    <link href="http://arktur04.github.io/blog/2015/11/05/vga-%25d0%25b0%25d0%25b4%25d0%25b0%25d0%25bf%25d1%2582%25d0%25b5%25d1%2580-%25d0%25bd%25d0%25b0-fpga/"/>
    <updated>2015-11-05T21:38:06+05:00</updated>
    <id>http://arktur04.github.io/blog/2015/11/05/vga-%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80-%d0%bd%d0%b0-fpga</id>
    <content type="html"><![CDATA[<p>Продолжение. <a title="Начало" href="http://arktur04.github.io/blog/2015/05/13/%25d0%25bf%25d1%2580%25d0%25be%25d0%25b5%25d0%25ba%25d1%2582-%25d0%25b2%25d0%25b8%25d0%25b4%25d0%25b5%25d0%25be%25d0%25b0%25d0%25b4%25d0%25b0%25d0%25bf%25d1%2582%25d0%25b5%25d1%2580%25d0%25b0-%25d1%2587%25d0%25b0%25d1%2581%25d1%2582%25d1%258c-1/">Начало</a>.</p>


<p>Проект видеоадаптера переделан под использование видео ЦАП ADV7123. Схема подключения приведена на рисунке:</p>


<p><a href="/images/2015/11/VGA_DAC.jpg"><img class="alignnone size-medium wp-image-2168" alt="VGA_DAC" src="/assets/VGA_DAC-300x190.jpg" width="300" height="190" /></a></p>


<p>(по клику откроется полный размер).</p>


<p>Код проекта приведён на гитхабе (<a href="https://github.com/arktur04/VideoCard">ссылка</a>). Это тестовый код, который выводит на монитор поле разноцветных квадратов.</p>


<p>По сравнению с предыдущей версией, в которой использовался резистивный ЦАП, увеличена разрядность с 2-х до 8-и бит на цвет, и существенно улучшилось качество изображения.</p>


<p>Фото тестовой картинки:</p>


<p><a href="/images/2015/11/pic1.jpg"><img class="alignnone size-medium wp-image-2166" alt="pic" src="/assets/pic1-300x189.jpg" width="300" height="189" /></a></p>


<p>&nbsp;</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Проект видеоадаптера. Часть 1]]></title>
    <link href="http://arktur04.github.io/blog/2015/05/13/%25d0%25bf%25d1%2580%25d0%25be%25d0%25b5%25d0%25ba%25d1%2582-%25d0%25b2%25d0%25b8%25d0%25b4%25d0%25b5%25d0%25be%25d0%25b0%25d0%25b4%25d0%25b0%25d0%25bf%25d1%2582%25d0%25b5%25d1%2580%25d0%25b0-%25d1%2587%25d0%25b0%25d1%2581%25d1%2582%25d1%258c-1/"/>
    <updated>2015-05-13T22:21:00+05:00</updated>
    <id>http://arktur04.github.io/blog/2015/05/13/%d0%bf%d1%80%d0%be%d0%b5%d0%ba%d1%82-%d0%b2%d0%b8%d0%b4%d0%b5%d0%be%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%d0%b0-%d1%87%d0%b0%d1%81%d1%82%d1%8c-1</id>
    <content type="html"><![CDATA[<p>Целью проекта является разработка видеоадаптера на FPGA. Выходом видеоадаптера является VGA, на данный момент поддерживается глубина цвета 6 бит (по 2 бита на цвет RGB).<br />
Разъём VGA подключен к FPGA по следующей схеме:</p>


<p><a href="/images/2015/05/schematics.jpg"><img class="alignnone  wp-image-2038" alt="schematics" src="/assets/schematics.jpg" width="475" height="358" /></a></p>


<p>&nbsp;</p>


<p>Резисторы R1-R6 образуют простейший ЦАП, для начала хватит такого, если нужна большая глубина цвета, то лучше использовать специализированные микросхемы видеоЦАП, например ADV7123.</p>


<p><!--more--></p>


<p>На данный момент реализован генератор синхроимпульсов, который генерирует сигналы H_SYNC и V_SYNC, а также генерирует текущий номер пиксела по горизонтали и вертикали. Реализовано 4 режима:</p>


<p>режим 0 - (640 * 480)</p>


<p>режим 1 - (640 * 400)</p>


<p>режим 2 - (640 * 350)</p>


<p>режим 3 - (320 * 200)</p>


<p>В режимах 0, 1 и 3 монитор фактически работает в режиме 640 * 480, при этом в режиме 1 изображение имеет чёрные поля сверху и снизу, в режиме 3 каждый пиксел изображения "удваивается" по горизонтали и по вертикали, то есть фактический размер изображения получается (640 * 400), и также имеются чёрные поля сверху и снизу. В режиме 2 монитор работает непосредственно в режиме (640 * 350).</p>


<p>Теоретически, существует стандартный режим 640х400, но монитор отказался работать в таком режиме, поэтому пришлось его имитировать на режиме 640х480. Режим 320х200 - то же самое.</p>


<p>Модуль работает на тактовой частоте 50МГц, частота пикселов составляет 25МГц. По стандарту частота пикселов в режимах 640х480@60Гц и 640х350@70Гц составляет 25,175МГц, но мониторы успешно синхронизируются и на 25МГц.</p>


<p>Фото экрана для примера:</p>


<p><a href="/images/2015/05/pic1.jpg"><img class="alignnone size-medium wp-image-2039" alt="pic1" src="/assets/pic1-300x226.jpg" width="300" height="226" /></a></p>


<p>Код на гитхабе: <a href="https://github.com/arktur04/VideoCard/archive/master.zip">https://github.com/arktur04/VideoCard/archive/master.zip</a></p>


<p>Полезная ссылка: <a href="http://tinyvga.com/vga-timing">http://tinyvga.com/vga-timing</a> - таблица режимов VGA с таймингами.</p>


<p>Это первая часть проекта, один модуль. Следующей частью будет модуль двухпортовой памяти для видеобуфера.</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Плата контроллера и ЦАП]]></title>
    <link href="http://arktur04.github.io/blog/2011/09/15/%25d0%25bf%25d0%25bb%25d0%25b0%25d1%2582%25d0%25b0-%25d0%25ba%25d0%25be%25d0%25bd%25d1%2582%25d1%2580%25d0%25be%25d0%25bb%25d0%25bb%25d0%25b5%25d1%2580%25d0%25b0-%25d0%25b8-%25d1%2586%25d0%25b0%25d0%25bf/"/>
    <updated>2011-09-15T19:30:26+06:00</updated>
    <id>http://arktur04.github.io/blog/2011/09/15/%d0%bf%d0%bb%d0%b0%d1%82%d0%b0-%d0%ba%d0%be%d0%bd%d1%82%d1%80%d0%be%d0%bb%d0%bb%d0%b5%d1%80%d0%b0-%d0%b8-%d1%86%d0%b0%d0%bf</id>
    <content type="html"><![CDATA[<p>Плата с микроконтроллером, интерфейсами RS-232, USB, RS-485 (гальванически изолированный) и выходами сигналов тока 4-20 мА (гальванически изолированы друг от друга и от контроллера), 2 канала. Контроллер LPC1768 (Cortex M3).</p>


<p><a href="/images/2011/09/pic_board.jpg"><img class="alignnone size-medium wp-image-1315" title="pic_board" src="/assets/pic_board-285x300.jpg" alt="" width="285" height="300" /></a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Фото прибора]]></title>
    <link href="http://arktur04.github.io/blog/2011/09/05/%25d1%2584%25d0%25be%25d1%2582%25d0%25be-%25d0%25bf%25d1%2580%25d0%25b8%25d0%25b1%25d0%25be%25d1%2580%25d0%25b0/"/>
    <updated>2011-09-05T13:36:35+06:00</updated>
    <id>http://arktur04.github.io/blog/2011/09/05/%d1%84%d0%be%d1%82%d0%be-%d0%bf%d1%80%d0%b8%d0%b1%d0%be%d1%80%d0%b0</id>
    <content type="html"><![CDATA[<p>Фото нового прибора (двухканальный вариант)</p>


<p><a href="/images/2011/09/P1010103.jpg"><img class="alignnone size-medium wp-image-1307" title="P1010103" src="/assets/P1010103-300x272.jpg" alt="" width="300" height="272" /></a></p>

]]></content>
  </entry>
  
</feed>
